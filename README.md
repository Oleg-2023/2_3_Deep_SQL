# 2_3_Deep_SQL
## Задание
Напишите SQL-запросы, который выполняют следующие действия:
1. Возвращает список клиентов (имя и фамилия) с наибольшей общей суммой заказов.
2. Для каждого клиента из пункта 1 выводит список его заказов (номер заказа и общая сумма) в порядке убывания общей суммы заказов.
3. Выводит только тех клиентов, у которых общая сумма заказов превышает среднюю общую сумму заказов всех клиентов.

Важно использовать подзапросы, агрегатные функции и объединения таблиц, чтобы выполнить это задание. Оптимизируйте запрос, где это возможно.
## Реализация
Примечание: В задании не указано количество клиентов с наибольшей общей суммой заказов. Принимаем его раным 3.
1. Формируем список клиентов с наибольшей суммой заказов, отсортировываем результат в порядке убывания и отббираем первые 3 записи.
2. Во временной таблице __Liders__ определяем 3-х лидеров покупок.
   В главном запросе формируем список клиентов, расположенных в порядке убывания общей сумме заказов.
   Общая сумма заказов клиента расчитана с помощью оконной функции.
   Количество клиентов ограничено 3-мя клиентами во временной таблице __Liders__  
3. Во временной таблице __CustomerAmounts__ рассчитываем общую сумму заказов по клиентам.  
  В основном запросе выбираем из временной таблицы только тех клиентов, у которых общая сумма заказов более средней по клиентам
   

